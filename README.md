# Universal NVR System ğŸ“¹

**A multi-stage Python & Docker framework for discovering, normalizing, and viewing IP cameras from any vendor.**

## ğŸ“‹ Project Overview

This system solves the fragmentation in the IP camera market by acting as a universal translation layer. It automates the entire lifecycle of an NVR:
1.  **Discovery (The Hunter):** Finds devices on the LAN via ARP.
2.  **Connection (The Diplomat):** Negotiates RTSP streams via ONVIF, Brute-force, or Vendor Hacks.
3.  **Ingestion (The Normalizer):** Feeds streams into a Go2RTC/FFmpeg core for recording.
4.  **Visualization (The Dashboard):** A sub-second latency WebRTC interface built with Streamlit.

---

## ğŸ—ï¸ Architecture

| Phase | Script | Purpose | Tech Stack |
| :--- | :--- | :--- | :--- |
| **1** | `scanner.py` | Network Scanning & Vendor ID | Scapy, MacVendorLookup |
| **2** | `connector.py` | Stream Discovery (Triple-Key Protocol) | ONVIF-Zeep, OpenCV |
| **3** | `config_builder.py` | Infrastructure Automation | Python, Jinja2 logic |
| **4** | `docker-compose.yml` | NVR Core & Recording Engine | Docker, Go2RTC, FFmpeg |
| **5** | `app.py` | User Interface | Streamlit, WebRTC |

---

## âš™ï¸ Prerequisites

* **OS:** Linux (Ubuntu/Debian recommended) or macOS. Windows is supported via WSL2.
* **Python:** 3.8+
* **Docker:** Docker Engine & Docker Compose installed.
* **Root Privileges:** Required for ARP scanning (Phase 1).

### Install Python Dependencies
```bash
pip3 install scapy mac-vendor-lookup onvif-zeep opencv-python streamlit requests


Coding partner
This is the final piece of the puzzle. A good README.md is the difference between "code that works" and "a deployable product."

Here is the comprehensive documentation for your Universal NVR system. Save this file in the root of your project folder.

The Code: README.md
Markdown
# Universal NVR System ğŸ“¹

**A multi-stage Python & Docker framework for discovering, normalizing, and viewing IP cameras from any vendor.**

## ğŸ“‹ Project Overview

This system solves the fragmentation in the IP camera market by acting as a universal translation layer. It automates the entire lifecycle of an NVR:
1.  **Discovery (The Hunter):** Finds devices on the LAN via ARP.
2.  **Connection (The Diplomat):** Negotiates RTSP streams via ONVIF, Brute-force, or Vendor Hacks.
3.  **Ingestion (The Normalizer):** Feeds streams into a Go2RTC/FFmpeg core for recording.
4.  **Visualization (The Dashboard):** A sub-second latency WebRTC interface built with Streamlit.

---

## ğŸ—ï¸ Architecture

| Phase | Script | Purpose | Tech Stack |
| :--- | :--- | :--- | :--- |
| **1** | `scanner.py` | Network Scanning & Vendor ID | Scapy, MacVendorLookup |
| **2** | `connector.py` | Stream Discovery (Triple-Key Protocol) | ONVIF-Zeep, OpenCV |
| **3** | `config_builder.py` | Infrastructure Automation | Python, Jinja2 logic |
| **4** | `docker-compose.yml` | NVR Core & Recording Engine | Docker, Go2RTC, FFmpeg |
| **5** | `app.py` | User Interface | Streamlit, WebRTC |

---

## âš™ï¸ Prerequisites

* **OS:** Linux (Ubuntu/Debian recommended) or macOS. Windows is supported via WSL2.
* **Python:** 3.8+
* **Docker:** Docker Engine & Docker Compose installed.
* **Root Privileges:** Required for ARP scanning (Phase 1).

### Install Python Dependencies
```bash
pip3 install scapy mac-vendor-lookup onvif-zeep opencv-python streamlit requests
ğŸš€ Quick Start Guide
Step 1: Scan the Network (The Hunter)
Find all devices on your local subnet.

Note: Requires sudo for raw packet generation.

Output: network_map.json

Bash
sudo python3 scanner.py -t 192.168.1.0/24
Step 2: Find the Streams (The Diplomat)
Run the "Triple-Key Protocol" to unlock video URLs.

Output: valid_streams.json

Bash
python3 connector.py
Step 3: Build the Core (The Normalizer)
Generate the go2rtc.yaml config and record_streams.sh recording script.

Bash
python3 config_builder.py
Step 4: Launch the Infrastructure
Start the Streaming Server and Recorder containers.

Bash
docker-compose up -d
Verify: Check http://localhost:1984 to see the Go2RTC dashboard.

Step 5: Start the Dashboard
Launch the user interface.

Bash
streamlit run app.py
Access: Open the URL displayed in the terminal (usually http://localhost:8501).

ğŸ“‚ Project Structure
Plaintext
Universal-NVR/
â”œâ”€â”€ scanner.py          # Phase 1: ARP Scanner
â”œâ”€â”€ connector.py        # Phase 2: Stream Finder
â”œâ”€â”€ config_builder.py   # Phase 3: Config Generator
â”œâ”€â”€ app.py              # Phase 4: Streamlit UI
â”œâ”€â”€ docker-compose.yml  # NVR Stack Definition
â”œâ”€â”€ network_map.json    # Generated by scanner.py
â”œâ”€â”€ valid_streams.json  # Generated by connector.py
â”œâ”€â”€ go2rtc.yaml         # Generated by config_builder.py
â”œâ”€â”€ record_streams.sh   # Generated by config_builder.py
â”œâ”€â”€ README.md           # Documentation
â””â”€â”€ storage/            # Recording destination (mounted volume)
ğŸ”§ Troubleshooting
1. "Permission Denied" during Scanning

ARP scanning requires Layer 2 access. You must run scanner.py with sudo.

2. "ONVIF Error" or Library not found

Ensure onvif-zeep is installed. Some cameras use non-standard ports (8899, 8000). You can modify connector.py to add these ports to the scan list.

3. Docker: "Bind for 0.0.0.0:1984 failed"

Go2RTC uses port 1984 for its API. Ensure no other service (like Frigate) is using this port, or change the mapping in docker-compose.yml.

4. Recordings not saving

Check permissions on your storage folder.

Bash
chmod -R 777 /path/to/storage
ğŸ›¡ï¸ License
Project created for educational purposes.


### **Final Handover**

You now have a complete, end-to-end codebase.
1.  **Scanner** to find the hardware.
2.  **Connector** to hack the software.
3.  **Builder** to automate the ops.
4.  **Dashboard** to sell the vision.
